
# ==========================
# ğŸ§© Flask + LINE Webhooké€£æº
# ==========================
from flask import Flask, request, abort
import os
import random

from linebot.v3.messaging import (
    MessagingApi,
    Configuration,
    ReplyMessageRequest,
    TextMessage,
    FlexMessage
)

from linebot.v3.webhook import WebhookHandler
from linebot.v3.webhooks import MessageEvent
from linebot.exceptions import InvalidSignatureError

# Flaskã‚¢ãƒ—ãƒªåˆæœŸåŒ–
app = Flask(__name__)

# LINE APIã®èªè¨¼æƒ…å ±ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çš„ã«ã¯æœ¬æ¥ã¯ç’°å¢ƒå¤‰æ•°ãŒæ¨å¥¨ï¼‰
LINE_CHANNEL_ACCESS_TOKEN = 'tIyCE/xxxxxx...çœç•¥...'
LINE_CHANNEL_SECRET = '4dc62a09bfc7d5f785dbba1538a0483b'

# âœ… v3å¯¾å¿œã®MessagingApiåˆæœŸåŒ–ï¼ˆâ†ã“ã“ã ã‘ä¿®æ­£ï¼‰
config = Configuration(access_token=LINE_CHANNEL_ACCESS_TOKEN)
line_bot_api = MessagingApi(config)  # â† ã“ã“ï¼

# Webhookãƒãƒ³ãƒ‰ãƒ©
handler = WebhookHandler(LINE_CHANNEL_SECRET)

# ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†è¾æ›¸
user_states = {}



@app.route("/callback", methods=["POST"])
def callback():
    signature = request.headers["X-Line-Signature"]
    body = request.get_data(as_text=True)

    print("ğŸŸ¡ å—ä¿¡ã—ãŸbody:", body)

    try:
        handler.handle(body, signature)
        print("ğŸŸ¢ handler.handle() æˆåŠŸï¼")
    except InvalidSignatureError:
        print("âŒ ã‚·ã‚°ãƒãƒãƒ£ã‚¨ãƒ©ãƒ¼ï¼šToken/Secreté•ã„ã‹ã‚‚")
        abort(400)
    except Exception as e:
        print("ğŸ’¥ ãã®ä»–ã®ã‚¨ãƒ©ãƒ¼:", e)

    return "OK"

@app.route("/")
def home():
    return "ã‚¯ãƒ­ãƒå ã„Botã¯v3ã§å‹•ä½œä¸­ã‚„ã§ã€‚LINEã‹ã‚‰ã€å ã£ã¦ã€ã£ã¦é€ã£ã¦ãªï¼"

# ==========================
# â‘  ä¼šè©±ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®å¯¾è©±ãƒ»ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†ï¼‰
# ==========================

user_states = {}
user_inputs = {}


def handle_message(event):
    user_id = event.source.user_id
    msg = event.message.text
    state = user_states.get(user_id, "start")
    reply = ""

    if "å ã„" in msg:
        return

    if msg in ["å ã£ã¦", "ã†ã‚‰ãªã„", "start"]:
        user_states[user_id] = "choose_type"
        reply = (
            "ã‚¯ãƒ­ãƒï¼šã¯ãâ€¦â€¦ã¾ãŸã‚ªãƒ¬ã®å‡ºç•ªã‹ã‚ˆã€‚"
            "ã—ã‚ƒãƒ¼ã­ã‡ãªã€‚ã§ã€ä½•ã‚’å ãˆã°ã„ã„ã‚“ã ï¼Ÿ"
            "ã€1ã€‘ç›¸æ€§è¨ºæ–­"
            "ã€2ã€‘ã‚¿ãƒ­ãƒƒãƒˆ"
            "ã€3ã€‘ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼"
            "ç•ªå·ã§ã‚‚ã€åå‰ã§ã‚‚ã„ã„ã‹ã‚‰è¨€ãˆã€‚"
        )

    elif state == "choose_type":
        if msg in ["1", "ç›¸æ€§", "ç›¸æ€§è¨ºæ–­"]:
            user_states[user_id] = "ask_name"
            reply = "ã‚¯ãƒ­ãƒï¼šç›¸æ€§ãƒï¼Ÿ â€¦çŸ¥ã£ã¦ã©ã†ã™ã‚“ã ã‚ˆã€‚ã¾ã€ã„ã„ã‘ã©ãªã€‚ã¾ãšã¯ã‚ã‚“ãŸã®åå‰ã¯ï¼Ÿ"
        elif msg in ["2", "ã‚¿ãƒ­ãƒƒãƒˆ", "tarot"]:
            user_states[user_id] = "tarot"
        elif msg in ["3", "ã‚«ãƒ©ãƒ¼", "ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼", "è‰²"]:
            user_states[user_id] = "lucky"
            reply = "ã‚¯ãƒ­ãƒï¼šè‰²ã‰ï¼Ÿ â€¦ãã†ã„ã†ã®æ°—ã«ã™ã‚‹ã‚¿ã‚¤ãƒ—ã‹ã‚ˆã€‚" + run_lucky_color(user_id)
        else:
            reply = "ã‚¯ãƒ­ãƒï¼šãã‚“ãªå ã„ã¯ã­ã‡ã‚ˆã€‚ã¡ã‚ƒã‚“ã¨ã€1ã€œ3ã€‘ã®ç•ªå·ã‹ã€å ã„ã®åå‰ã‚’è¨€ãˆã£ã¦ã®ã€‚"

    elif state == "ask_name":
        if user_id not in user_inputs:
            user_inputs[user_id] = {}
        user_inputs[user_id]["name"] = msg
        user_states[user_id] = "ask_birth_month"
        reply = "ã‚¯ãƒ­ãƒï¼šèª•ç”Ÿæœˆã¯ï¼Ÿï¼ˆ1ã€œ12ã§ç­”ãˆã‚ï¼‰"

    elif state == "ask_birth_month":
        try:
            month = int(msg)
            if 1 <= month <= 12:
                user_inputs[user_id]["m1"] = month
                user_states[user_id] = "ask_birth_day"
                reply = "ã‚¯ãƒ­ãƒï¼šã§ã€ä½•æ—¥ç”Ÿã¾ã‚Œã ã‚ˆï¼Ÿ"
            else:
                reply = "ã‚¯ãƒ­ãƒï¼š1ã€œ12ã£ã¦è¨€ã£ã¦ã‚“ã ã‚ã€‚ã¡ã‚ƒã‚“ã¨æœˆã§ç­”ãˆã‚ã‚„ã€‚"
        except ValueError:
            reply = "ã‚¯ãƒ­ãƒï¼šæ•°å­—ã§æœˆã‚’è¨€ãˆã£ã¦ã®ã€‚"

    elif state == "ask_birth_day":
        try:
            day = int(msg)
            if 1 <= day <= 31:
                user_inputs[user_id]["d1"] = day
                user_states[user_id] = "ask_partner_name"
                reply = "ã‚¯ãƒ­ãƒï¼šæ°—ã«ãªã£ã¦ã‚‹ãƒ¤ãƒ„ã®åå‰ã¯ï¼Ÿ"
            else:
                reply = "ã‚¯ãƒ­ãƒï¼š1ã€œ31ã®é–“ã§è¨€ãˆã€‚å¸¸è­˜ãªï¼Ÿ"
        except ValueError:
            reply = "ã‚¯ãƒ­ãƒï¼šæ•°å­—ã§ç­”ãˆã‚ã‚ˆã€ã£ãŸãã€‚"

    elif state == "ask_partner_name":
        user_inputs[user_id]["partner"] = msg
        user_states[user_id] = "ask_partner_month"
        reply = "ã‚¯ãƒ­ãƒï¼šãã„ã¤ã®èª•ç”Ÿæœˆã¯ï¼Ÿ"

    elif state == "ask_partner_month":
        try:
            month = int(msg)
            if 1 <= month <= 12:
                user_inputs[user_id]["m2"] = month
                user_states[user_id] = "ask_partner_day"
                reply = "ã‚¯ãƒ­ãƒï¼šã§ã€ä½•æ—¥ç”Ÿã¾ã‚Œã ï¼Ÿ"
            else:
                reply = "ã‚¯ãƒ­ãƒï¼šã¡ã‚ƒã‚“ã¨1ã€œ12ã®æœˆã§è¨€ãˆã‚„"
        except ValueError:
            reply = "ã‚¯ãƒ­ãƒï¼šæ•°å­—ã§é ¼ã‚€ã‚ã€‚ãã„ã¤ã®æœˆãªã€‚"

    elif state == "ask_partner_day":
        try:
            day = int(msg)
            if 1 <= day <= 31:
                user_inputs[user_id]["d2"] = day
                user_states[user_id] = "done"
                name = user_inputs[user_id]["name"]
                partner = user_inputs[user_id]["partner"]
                m1 = user_inputs[user_id]["m1"]
                d1 = user_inputs[user_id]["d1"]
                m2 = user_inputs[user_id]["m2"]
                d2 = user_inputs[user_id]["d2"]
                result = run_compatibility(user_id, m1, d1, m2, d2)
                reply = (
                    f"ã‚¯ãƒ­ãƒï¼šãµãƒ¼ã‚“â€¦ã˜ã‚ƒã€è¨ºã¦ã‚„ã‚‹ã‚ˆ"
                    f"ğŸ§‘â€ğŸ’¼ {name}ğŸ¯ {partner}"
                    f"{result}"
                    "â€¦â€¦æº€è¶³ã—ãŸã‹ï¼Ÿã¾ãŸå ã„ãŸã„ãªã‚‰ã€å ã£ã¦ã€ã£ã¦è¨€ãˆã‚ˆã€‚"
                )
            else:
                reply = "ã‚¯ãƒ­ãƒï¼šæ—¥ä»˜ã£ã¦ã®ã¯1ã€œ31ã®é–“ã ã‚ï¼Ÿå¸¸è­˜ã€‚"
        except ValueError:
            reply = "ã‚¯ãƒ­ãƒï¼šæ•°å­—ã£ã¦ã‚ã‹ã‚‹ã‹ï¼Ÿæ—¥ä»˜ã ã€æ—¥ä»˜ã€‚"

    else:
        reply = "ã‚¯ãƒ­ãƒï¼šâ€¦â€¦ã£ãŸãã€ã‚ã‹ã‚“ã­ãƒ¼ãªã‚‰æœ€åˆã‹ã‚‰ã€å ã£ã¦ã€ã£ã¦è¨€ãˆã‚ˆãªã€‚"



    # â€» ä»–ã®ã‚¹ãƒ†ãƒ¼ãƒˆï¼ˆask_nameä»¥é™ï¼‰ã¯åˆ¥é€”è¿½è¨˜ã™ã‚‹



# ==========================
# â‘¡ å ã„ãƒ­ã‚¸ãƒƒã‚¯æœ¬ä½“ï¼ˆç›¸æ€§ãƒ»ã‚¿ãƒ­ãƒƒãƒˆãƒ»ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼ãªã©ï¼‰
# ==========================

# ----- ğŸ’• ç›¸æ€§è¨ºæ–­ -----

def run_compatibility(user_id, m1, d1, m2, d2):
    # ã‚·ãƒ³ãƒ—ãƒ«ãªç›¸æ€§ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆèª•ç”Ÿæ—¥ã®å·®ã‚’ãƒ™ãƒ¼ã‚¹ã«ï¼‰
    score = abs((m1 * 30 + d1) - (m2 * 30 + d2)) % 100
    score = 100 - score

    if score >= 90:
        comment = "ğŸ˜ ã¯ã„ã¯ã„ã€ç›¸æ€§ãƒãƒƒãƒãƒªã€‚ã„ã¡ã‚ƒã„ã¡ã‚ƒã—ã¨ã‘"
    elif score >= 70:
        comment = "ğŸ˜Œ ã¾ãæ‚ªããªã„ãªã€‚ã§ã‚‚æ²¹æ–­ã™ã‚“ãªã‚ˆ"
    elif score >= 50:
        comment = "ğŸ˜¶ å¾®å¦™ã£ã¦ã‚„ã¤ã ãªã€‚ãªã‚“ã‹åˆã£ã¦ã‚‹ã‚ˆã†ã§åˆã£ã¦ãªã„"
    elif score >= 30:
        comment = "ğŸ˜¬ ã‚±ãƒ³ã‚«ã°ã£ã‹ã˜ã‚ƒã­ã‡ã®ã‹ï¼Ÿ"
    else:
        comment = "ğŸ’€ ç„¡ç†ã€‚ã‚„ã‚ã¨ã‘"

    return f"ç›¸æ€§ã‚¹ã‚³ã‚¢ï¼š{score}ç‚¹\nã‚¯ãƒ­ãƒï¼š{comment}"


# ----- ğŸƒ ã‚¿ãƒ­ãƒƒãƒˆã‚»ãƒªãƒ•è¾æ›¸ï¼ˆtarot_kurone_linesï¼‰ -----
tarot_kurone_lines = {
    "æ„šè€…": {
        "éå»": "ãªãƒ¼ã‚“ã‚‚è€ƒãˆã‚“ã¨çªã£èµ°ã£ãŸãƒ„ã‚±ã€ä»Šé ƒå‡ºã¨ã‚‹ã ã‘ã‚„ã‚â€¦",
        "ç¾åœ¨": "ã¯ãâ€¦è‡ªç”±ã«è¦‹ãˆã¦ã€ãŸã ã®ç¾å®Ÿé€ƒé¿ã£ã¦ã“ã¨ã€æ°—ã¥ã„ã¦ã¸ã‚“ã‚„ã‚",
        "æœªæ¥": "è½ã¡ã‚‹ã¨ã“ã¾ã§è½ã¡ã¦ã€ã‚ˆã†ã‚„ãåœ°ã«è¶³ã¤ãã‹ã‚‚ãªã€‚ã§ã‚‚ã€ãã‚Œã‚‚æ‚ªããªã„â€¦ã‹ã‚‚ãª"
    },
    "é­”è¡“å¸«": {
        "éå»": "å™¨ç”¨è²§ä¹ã‚„ã£ãŸã‚“ã¡ã‚ƒã†ï¼Ÿãªã‚“ã§ã‚‚æ‰‹å‡ºã—ã¦ã€ãªã‚“ã‚‚ãƒ¢ãƒã«ãªã£ã¦ã¸ã‚“",
        "ç¾åœ¨": "å§‹ã‚ã‚‹ã®ã¯ãˆãˆã‘ã©ã€ä¸­èº«ã‚¹ã‚«ã‚¹ã‚«ã‚„ã£ãŸã‚‰æ„å‘³ãªã„ã§",
        "æœªæ¥": "ã‚‚ã—ä»Šã®åŠªåŠ›ãŒå®Ÿã‚’çµã¶ãªã‚‰â€¦å¥‡è·¡ã‚„ãªã€‚ã§ã‚‚ã€ãªã„ã¨ã¯è¨€ã‚ã¸ã‚“ã§"
    },
    "å¥³æ•™çš‡": {
        "éå»": "åˆ†ã‹ã£ãŸãµã‚Šã—ã¦è·é›¢ç½®ã„ã¦ãŸã‚„ã‚ï¼Ÿã»ã‚“ã¾ã¯ä½•ã‚‚è¦‹ãˆã¦ãªã‹ã£ãŸã‚“ã¡ã‚ƒã†ã‹",
        "ç¾åœ¨": "é™ã‹ã«ã—ã¦ãŸã‚‰æ­£è§£ãŒé™ã£ã¦ãã‚‹ã¨æ€ã†ã¦ã‚‹ã‚“ï¼Ÿç”˜ã„ã§",
        "æœªæ¥": "æœ¬ç‰©ã®ç›´æ„Ÿã£ã¦ã‚„ã¤ãŒå‡ºã¦ãã‚‹ã‹ã‚‚ãªâ€¦ãã‚Œã€ä¿¡ã˜ã‚‰ã‚ŒãŸã‚‰ã®è©±ã‚„ã‘ã©"
    },
    "å¥³å¸": {
        "éå»": "ç”˜ã‚„ã‹ã•ã‚ŒãŸçµæœãŒä»Šã®ã¬ã‚‹ã„è‡ªåˆ†ã¡ã‚ƒã†ï¼Ÿ",
        "ç¾åœ¨": "ä¸ãˆã‚‹ã¨ã‹åŒ…ã¿è¾¼ã‚€ã¨ã‹â€¦ã‚ã‚“ãŸã«ãã®ä½™è£•ã€ã‚ã‚‹ã‚“ã‹ï¼Ÿ",
        "æœªæ¥": "ã‚‚ã—ä»Šã€èª°ã‹ã‚’ã¡ã‚ƒã‚“ã¨å¤§äº‹ã«ã§ãã‚‹ãªã‚‰â€¦ãã‚Œã¯èª‡ã£ã¦ãˆãˆã‹ã‚‚ã—ã‚Œã‚“ãª"
    },
    "çš‡å¸": {
        "éå»": "åŠ›ã§ã­ã˜ä¼ã›ã‚ˆã†ã¨ã—ã¦ã€çµå±€å­¤ç‹¬ã«ãªã£ãŸã ã‘ã‚„ã‚",
        "ç¾åœ¨": "å¨å³ã¨ã‹è¨€ã†å‰ã«ã€è‡ªåˆ†ã®ä¸å®‰éš ã™ã®ã‚„ã‚ãŸã‚‰ã©ã†ã‚„ï¼Ÿ",
        "æœªæ¥": "ã‚‚ã—èª°ã‹ã«èƒŒä¸­è¦‹ã›ã‚‰ã‚Œã‚‹æ—¥ãŒæ¥ã‚‹ãªã‚‰â€¦ãã®æ™‚ã¯ã¡ã‚ƒã‚“ã¨ç«‹ã¦ã€çµ¶å¯¾ã«"
    },
    "æ•™çš‡": {
        "éå»": "äººã®è¨€ã†ã“ã¨ã°ã£ã‹èã„ã¦ã€è‡ªåˆ†ã®å£°ç„¡è¦–ã—ã¦ãŸã‚“ã¡ã‚ƒã†ï¼Ÿ",
        "ç¾åœ¨": "æ•™ãˆã¨ã‹ãƒ«ãƒ¼ãƒ«ã£ã¦ã€æ™‚ã«ã¯æ¯’ã«ãªã‚‹ã­ã‚“ã€‚æ°—ã¥ã‘ã‚„",
        "æœªæ¥": "æ­£ã—ã•ã«å®ˆã‚‰ã‚Œã‚‹ã‚“ã˜ã‚ƒãªãã€æ­£ã—ã•ã‚’é¸ã¹ã‚‹ãªã‚‰â€¦ãã®æ™‚ã¯ã¡ã‚‡ã£ã¨ã€å¸Œæœ›ã‚ã‚‹ã‹ã‚‚ãª"
    },
    "æ‹äºº": {
        "éå»": "é¸ã°ã‚Œã¸ã‚“ã‹ã£ãŸã‚“ã¯ã€ãŠå‰ã®ã›ã„ã‚„ã‚",
        "ç¾åœ¨": "è‡ªåˆ†ã®æ°—æŒã¡ã™ã‚‰ã‚ã‹ã‚‰ã‚“ã®ã«ã€ä»–äººã¨å‘ãåˆãˆã‚‹ã‚ã‘ãªã„ã‚„ã‚“",
        "æœªæ¥": "ã‚‚ã—æœ¬å½“ã«é¸ã¶è¦šæ‚ŸãŒã§ããŸã‚‰â€¦ä»Šåº¦ã“ãã€æ‰‹æ”¾ã•ãšã«ã™ã‚€ã‹ã‚‚ãª"
    },
    "æˆ¦è»Š": {
        "éå»": "çªã£èµ°ã£ãŸã¯ãˆãˆã‘ã©ã€å¿ƒã¯ã©ã£ã‹ã«ç½®ã„ã¦ããŸã‚“ã¡ã‚ƒã†ï¼Ÿ",
        "ç¾åœ¨": "å‹ã¡ãŸãã¦å¿…æ­»ãªã‚“ã‚„ã‚ï¼Ÿã§ã‚‚ã€ä½•ã«å‹ã¤ã¤ã‚‚ã‚Šã‚„ã­ã‚“",
        "æœªæ¥": "ã‚‚ã—æœ¬æ°—ã§é€²ã‚€è¦šæ‚ŸãŒã‚ã‚‹ãªã‚‰â€¦å‹ã¡æ–¹ã‚‚è¦‹ãˆã¦ãã‚‹ã‹ã‚‚ãªã€‚ã‚ªãƒ¬ã‚‚â€¦ã¡ã‚‡ã£ã¨å¿œæ´ã™ã‚‹ã‚"
    },
    "åŠ›": {
        "éå»": "æŠ‘ãˆè¾¼ã‚“ã§ãŸã ã‘ã§ã€ãªã‚“ã‚‚å…‹æœã§ãã¦ã¸ã‚“ã‚„ã‚“",
        "ç¾åœ¨": "å¼·ãŒã£ã¦ã‚“ã®ã€ãƒãƒ¬ãƒãƒ¬ã‚„ã§",
        "æœªæ¥": "ã»ã‚“ã¾ã®å¼·ã•ã£ã¦ã®ã‚’è¦‹ã›ã¦ãã‚Œã‚‹ã‚“ã‚„ã£ãŸã‚‰â€¦ã‚ªãƒ¬ã€è¦‹å±Šã‘ã¦ã‚‚ãˆãˆã‚"
    },
    "éš è€…": {
        "éå»": "é€ƒã’ãŸã ã‘ã‚„ã‚“ã€‚ã²ã¨ã‚Šã«ãªã‚‹ã®ãŒæ¥½ã‚„ã£ãŸã ã‘ã‚„ã‚",
        "ç¾åœ¨": "ã»ã‚“ã¾ã¯èª°ã‹ã«æ°—ã¥ã„ã¦ã»ã—ã„ãã›ã«ã€æ®»ã«ã“ã‚‚ã£ã¦ã‚‹ã¨ã‹ãƒ€ã‚µã„ã§",
        "æœªæ¥": "ãã®å­¤ç‹¬ãŒã€ã„ã¤ã‹å…‰ã«å¤‰ã‚ã‚‹ãªã‚‰â€¦æ‚ªã„æœªæ¥ã‚„ãªã„ãª"
    },
    "é‹å‘½ã®è¼ª": {
        "éå»": "ãƒãƒ£ãƒ³ã‚¹ã‚„ã£ãŸã‹ã‚‚ã—ã‚Œã¸ã‚“ã‘ã©ã€çµå±€æµã•ã‚Œã¦çµ‚ã‚ã‚Šã‚„ã£ãŸã‚“ã¡ã‚ƒã†",
        "ç¾åœ¨": "é‹ã«é ¼ã‚‹ã—ã‹ãªã„ã£ã¦çŠ¶æ³ã€ã‚‚ã†è©°ã‚“ã©ã‚‹ã‚„ã‚“",
        "æœªæ¥": "ã§ã‚‚ãªã€é‹å‘½ã£ã¦ã‚„ã¤ãŒå‘³æ–¹ã—ã¦ãã‚Œã‚‹ç¬é–“ã‚‚â€¦ãŸã¾ã«ã‚ã‚‹ã€‚ä¿¡ã˜ã‚‹ã‹ã©ã†ã‹ã¯ãŠå‰æ¬¡ç¬¬ã‚„"
    },
    "æ­£ç¾©": {
        "éå»": "ãƒãƒ©ãƒ³ã‚¹å–ã£ãŸã¤ã‚‚ã‚ŠãŒã€èª°ã‹ã«çŠ ç‰²æŠ¼ã—ä»˜ã‘ãŸã ã‘ã¡ã‚ƒã†ï¼Ÿ",
        "ç¾åœ¨": "è‡ªåˆ†ãŒæ­£ã—ã„ã£ã¦æ€ã„ãŸã„ã ã‘ã‚„ã‚ã€‚ã»ã‚“ã¾ã¯æºã‚‰ã„ã§ã‚“ã®ã«",
        "æœªæ¥": "ã‚‚ã—æœ¬å½“ã«è‡ªåˆ†ã¨å‘ãåˆãˆã‚‹ãªã‚‰ã€ã¡ã‚‡ã£ã¨ã¯æ•‘ã‚ã‚Œã‚‹ã‚“ã‹ã‚‚ãª"
    },
    "åŠã‚‹ã•ã‚ŒãŸç”·": {
        "éå»": "æˆ‘æ…¢ã—ãŸãƒ•ãƒªã—ã¦ã€ä½•ã‚‚å¤‰ãˆã‚‹æ°—ãªã‹ã£ãŸã ã‘ã‚„ã‚",
        "ç¾åœ¨": "å‹•ã‘ã¸ã‚“è¨€ã„è¨³ã—ã¦ã€è‡ªåˆ†ã‹ã‚‰æ­¢ã¾ã£ã¦ã‚“ã®æ°—ã¥ã„ã¦ã‚‹ï¼Ÿ",
        "æœªæ¥": "ãã‚Œã§ã‚‚è¦‹æ–¹ã‚’å¤‰ãˆãŸã‚‰â€¦ä¸–ç•ŒãŒå°‘ã—ãƒã‚·ã«è¦‹ãˆã‚‹ã‹ã‚‚ãª"
    },
    "æ­»ç¥": {
        "éå»": "çµ‚ã‚ã£ãŸã®ã«ã€ã¾ã å¼•ããšã£ã¦ã‚‹ã‚“ã‚¢ãƒ›ã‚‰ã—",
        "ç¾åœ¨": "å¤‰ã‚ã‚‹ãƒãƒ£ãƒ³ã‚¹æ¥ã¨ã‚‹ã®ã«ã€ãƒ“ãƒ“ã£ã¦ä½•ã‚‚ã—ã¦ã¸ã‚“ã‚„ã‚“",
        "æœªæ¥": "çµ‚ã‚ã‚‹ã‹ã‚‰ã“ãå§‹ã¾ã‚‹ã‚“ã‚„ã€‚â€¦ã¾ã€çµ‚ã‚ã‚ŒãŸã‚‰ã®è©±ã‚„ã‘ã©ãª"
    },
    "ç¯€åˆ¶": {
        "éå»": "ã©ã£ã¡ã¤ã‹ãšã§ä¸­é€”åŠç«¯â€¦ãã‚Šã‚ƒä½•ã‚‚æ®‹ã‚‰ã‚“ã‚ãª",
        "ç¾åœ¨": "ã†ã¾ãã‚„ã‚ã†ã¨ã—ã¦ã€çµå±€ä½•ã«ã‚‚ã§ãã¦ã¸ã‚“ã‚„ã‚“",
        "æœªæ¥": "ã»ã‚“ã¾ã®èª¿å’ŒãŒè¨ªã‚Œã‚‹ãªã‚‰â€¦ãã‚ãã‚ãƒ–ãƒ¬ã‚‹ã®ã‚„ã‚ãˆã‚„"
    },
    "æ‚ªé­”": {
        "éå»": "æ¬²æœ›ã«é£²ã¾ã‚Œã¦ã€è‡ªåˆ†ã§ã‚‚æ°—ã¥ã‹ã‚“ã†ã¡ã«è…ã£ã¨ã£ãŸã‚“ã¡ã‚ƒã†ï¼Ÿ",
        "ç¾åœ¨": "ä¾å­˜ã«æ°—ã¥ã‹ã¸ã‚“ãµã‚Šã—ã¦ã‚‹ã‘ã©ã€ã‚‚ã†æ‰‹é…ã‚Œã‹ã‚‚ãª",
        "æœªæ¥": "ã§ã‚‚ã€ã‚‚ã—ãã®é–ã‚’è‡ªåˆ†ã§åˆ‡ã‚ŒãŸã‚‰â€¦ã¡ã‚‡ã£ã¨ã¯ãƒã‚·ãªæœªæ¥ã‚ã‚‹ã§"
    },
    "å¡”": {
        "éå»": "å…¨éƒ¨å´©ã‚ŒãŸã‚“ã¯ã€ãŠå‰ãŒè¦‹ã¦è¦‹ã¬ãµã‚Šã—ã¨ã£ãŸã‹ã‚‰ã‚„ã‚",
        "ç¾åœ¨": "ã‚ãƒ¼ã‚ã€ä»Šã¾ã•ã«å´©ã‚Œã¦ã‚‹ã¨ã“ã‚„ã‚“ã€‚ã©ã†ã™ã‚“ã®ã“ã‚Œï¼Ÿ",
        "æœªæ¥": "ã‚¼ãƒ­ã‹ã‚‰ã§ã‚‚ã€å»ºã¦ç›´ã›ã‚‹åŠ›ãŒã‚ã‚‹ãªã‚‰â€¦ã¾ã çµ‚ã‚ã‚Šã‚„ãªã„ãª"
    },
    "æ˜Ÿ": {
        "éå»": "å¸Œæœ›æŒã£ãŸãƒ•ãƒªã—ã¦ã€ä½•ã«ã‚‚ã—ã¦ã¸ã‚“ã‹ã£ãŸã‚“ã¡ã‚ƒã†ï¼Ÿ",
        "ç¾åœ¨": "ç†æƒ³èªã‚‹ã®ã¯ãˆãˆã‘ã©ã€ç¾å®Ÿè¦‹ãˆã¦ã¸ã‚“ã‚„ã‚",
        "æœªæ¥": "â€¦ãã‚Œã§ã‚‚ã€ãã®å…‰ã‚’ä¿¡ã˜ãŸã„ã£ã¦æ€ãˆã‚‹ãªã‚‰ã€ãˆãˆå¤¢ã‹ã‚‚ãª"
    },
    "æœˆ": {
        "éå»": "ä¸å®‰ã«æµã•ã‚Œã¦ã€ç¾å®Ÿã‚‚å¤¢ã‚‚ãã¡ã‚ƒãã¡ã‚ƒã‚„ã£ãŸã‚„ã‚",
        "ç¾åœ¨": "ç›®ã®å‰ã®ã“ã¨ã€ã»ã‚“ã¾ã«è¦‹ãˆã¦ã‚‹ã‚“ã‹ï¼Ÿå…¨éƒ¨å¹»ã¡ã‚ƒã†ã‚“ã‹",
        "æœªæ¥": "ãã‚Œã§ã‚‚è¿·ã„ãªãŒã‚‰é€²ã‚ã‚‹ãªã‚‰â€¦ã¡ã‚‡ã£ã¨ã¯ä¾¡å€¤ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã‚“ãª"
    },
    "å¤ªé™½": {
        "éå»": "æ¥½ã—ãã†ã«è¦‹ãˆã¦ã€çµå±€è¦‹æ „ã‚„ã£ãŸã ã‘ã¡ã‚ƒã†ï¼Ÿ",
        "ç¾åœ¨": "å¹¸ã›ãã†ã‚„ã‘ã©â€¦ãã‚Œã€ãƒ›ãƒ³ãƒã«æœ¬å¿ƒã‹ï¼Ÿæ¼”ã˜ã¦ã¸ã‚“ï¼Ÿ",
        "æœªæ¥": "â€¦ã§ã‚‚ãªã€ä»Šåº¦ã“ãå¿ƒã‹ã‚‰ç¬‘ãˆã‚‹ãªã‚‰ã€ãã‚Œã¯â€¦ç¾¨ã¾ã—ã„ã‹ã‚‚ãª"
    },
    "å¯©åˆ¤": {
        "éå»": "å¾Œæ‚”ã°ã£ã‹ã§ã€ä½•ã²ã¨ã¤æ¸…ç®—ã§ãã¦ã¸ã‚“ã‚„ã‚“",
        "ç¾åœ¨": "éå»ã«å¼•ããšã‚‰ã‚Œã¦ã€ä»Šã‚’æ¨ã¦ã‚‹ã¨ã‹ã‚¢ãƒ›ã™ãã‚„ã‚",
        "æœªæ¥": "ã»ã‚“ã¾ã«å‘ãåˆãˆãŸã‚‰ã€ç”Ÿã¾ã‚Œå¤‰ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¸ã‚“ãªâ€¦ä¸€å¿œã€ãª"
    },
    "ä¸–ç•Œ": {
        "éå»": "å®Œç’§æ±‚ã‚ã™ãã¦ã€è‡ªåˆ†ã§ã‚‚ç–²ã‚Œã¨ã£ãŸã‚“ã¡ã‚ƒã†ï¼Ÿ",
        "ç¾åœ¨": "ä»ŠãŒå®Œæˆå½¢ã¨ã‹æ€ã£ã¦ã¸ã‚“ã‚ˆãªï¼ŸãŸã ã®çµ‚ã‚ã‚Šã«è¦‹ãˆã‚‹ã§",
        "æœªæ¥": "ãã‚Œã§ã‚‚ã€ã»ã‚“ã¾ã«å…¨ã†ã§ããŸãªã‚‰â€¦ã‚ªãƒ¬ã€ã¡ã‚‡ã£ã¨ã ã‘èªã‚ãŸã‚‹ã‚"
    }
}

# ----- ğŸƒ ã‚¿ãƒ­ãƒƒãƒˆå ã„ï¼ˆ3æšå¼•ãï¼‰ -----

tarot_scores = {
    # ğŸŒŸ è¶…å‰ï¼ˆ+3ï¼‰
    "å¤ªé™½": 3,
    "ä¸–ç•Œ": 3,
    "æ˜Ÿ": 3,

    # ğŸ‘ å‰ï¼ˆ+2ï¼‰
    "æ‹äºº": 2,
    "æˆ¦è»Š": 2,
    "å¯©åˆ¤": 2,

    # ğŸ™‚ å°å‰ï¼ˆ+1ï¼‰
    "åŠ›": 1,
    "çš‡å¸": 1,
    "ç¯€åˆ¶": 1,

    # ğŸ˜ å¹³ï¼ˆ0ï¼‰
    "é­”è¡“å¸«": 0,
    "æ­£ç¾©": 0,
    "æ•™çš‡": 0,
    "æ„šè€…": 0,

    # ğŸ™ å°å‡¶ï¼ˆ-1ï¼‰
    "å¥³æ•™çš‡": -1,
    "éš è€…": -1,
    "æœˆ": -1,
    "åŠã‚‹ã•ã‚ŒãŸç”·": -1,

    # ğŸ˜– å‡¶ï¼ˆ-2ï¼‰
    "æ­»ç¥": -2,
    "æ‚ªé­”": -2,

    # ğŸ’€ å¤§å‡¶ï¼ˆ-3ï¼‰
    "å¡”": -3
}

# ----- ğŸƒ ã‚¿ãƒ­ãƒƒãƒˆå ã„ï¼ˆ3æšå¼•ãï¼‰ -----
def kurone_tarot_reading():

    
    cards = list(tarot_kurone_lines.keys())
    selected = random.sample(cards, 3)
    positions = ["éå»", "ç¾åœ¨", "æœªæ¥"]

    intro = "ğŸ¾ ã‚«ã‚µã‚«ã‚µâ€¦ã‚¯ãƒ­ãƒãŒç„¡è¨€ã§ã‚«ãƒ¼ãƒ‰ã‚’3æšä¸¦ã¹ãŸã€‚\n"
    intro += "ğŸ’­ã€Œã£ãŸãã€ã“ã‚“ãªã‚‚ã‚“å ã£ã¦ã©ã†ã™ã‚“ã ã‚ˆâ€¦â€¦ã€\n"
    intro += "ã§ã‚‚â€¦å°‘ã—ã ã‘æœ¬æ°—ã«ãªã£ãŸã‚ˆã†ã ã€‚\n"

    result = "ğŸ”® ã€ã‚¿ãƒ­ãƒƒãƒˆ3æšå¼•ãã€‘\n" + intro

    total_score = 0

    for i in range(3):
        card = selected[i]
        pos = positions[i]
        line = tarot_kurone_lines[card][pos]
        score = tarot_scores.get(card, 0)
        total_score += score
        result += f"\nâ”â”â”\nã€{pos}ã€‘ğŸƒ{card}ï¼ˆ{score:+d}ï¼‰\nğŸ’­ã‚¯ãƒ­ãƒã€Œ{line}ã€\n"

    # ğŸ’¯ ã‚¹ã‚³ã‚¢è©•ä¾¡ã‚³ãƒ¡ãƒ³ãƒˆ
    if total_score >= 6:
        comment = "â€¦ã‚ªãƒ¬ãŒè¨€ã†ã®ã‚‚ã‚¢ãƒ¬ã‚„ã‘ã©ã€é‹å‘½ã®å¯µå…ã¡ã‚ƒã†ã‹ï¼Ÿ"
    elif total_score >= 3:
        comment = "ãŠå‰ã«ã—ã¦ã¯â€¦ã¾ãä¸Šå‡ºæ¥ã‚„ãª"
    elif total_score >= 1:
        comment = "ã¾ãâ€¦æ‚ªãã¯ãªã„ã‚“ã¡ã‚ƒã†ï¼Ÿ"
    elif total_score >= -1:
        comment = "ã†ãƒ¼ã‚“ã€å¾®å¦™ã‚„ãª"
    elif total_score >= -4:
        comment = "æ­£ç›´ã€èª¿å­æ‚ªãã‚„ãª"
    else:
        comment = "â€¦â€¦ä»Šæ—¥ã¯å¯ã¨ã‘"

    result += f"\nâ”â”â”\nğŸ’¯ ç·åˆã‚¹ã‚³ã‚¢ï¼š{total_score:+d}ï¼ˆ{comment}ï¼‰"

    return result


def create_tarot_flex():
    cards = list(tarot_kurone_lines.keys())
    selected = random.sample(cards, 3)
    positions = ["éå»", "ç¾åœ¨", "æœªæ¥"]
    bubbles = []

    for i in range(3):
        card = selected[i]
        pos = positions[i]
        line = tarot_kurone_lines[card][pos]
        score = tarot_scores.get(card, 0)

        bubble = {
            "type": "bubble",
            "size": "kilo",
            "body": {
                "type": "box",
                "layout": "vertical",
                "spacing": "md",
                "contents": [
                    {"type": "text", "text": f"ã€{pos}ã€‘ğŸƒ{card}", "weight": "bold", "size": "lg"},
                    {"type": "text", "text": f"ã‚¹ã‚³ã‚¢ï¼š{score:+d}", "size": "sm", "color": "#999999"},
                    {"type": "box", "layout": "horizontal", "contents": [
                        {"type": "text", "text": f"ğŸ’­ ã‚¯ãƒ­ãƒã€Œ{line}ã€", "wrap": True, "size": "sm"}
                    ]}
                ]
            }
        }
        bubbles.append(bubble)

    # è¤‡æ•°ãƒãƒ–ãƒ«ã‚’carouselå½¢å¼ã§è¿”ã™
    flex = {
        "type": "carousel",
        "contents": bubbles
    }


# ----- ğŸŒˆ ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼å ã„ -----
lucky_colors = [
    {
        "color": "èµ¤",
        "emotion": ["ä»Šæ—¥ã¯ç‡ƒãˆã¦ã‚‹ãªâ€¦æ°—åˆã ã‘ã¯èªã‚ã¦ã‚„ã‚‹", "ã‚¢ãƒ„ããªã‚Šã™ãã¦ç©ºå›ã‚Šã™ã‚“ãªã‚ˆ"],
        "trend": "è¡Œå‹•åŠ›ã¨æƒ…ç†±ãŒé«˜ã¾ã‚Šã‚„ã™ã„æ—¥ã€‚",
        "advice": "è¨€ã„ãŸã„ã“ã¨ã¯ã¡ã‚ƒã‚“ã¨å£ã«å‡ºã›ã€‚ãŸã ã—ã‚±ãƒ³ã‚«è…°ã¯ã‚„ã‚ã¨ã‘ã€‚"
    },
    {
        "color": "é’",
        "emotion": ["å†·é™ï¼Ÿã‚ªãƒ¬ã«ã¯ç„¡ç†ã ãªã€‚ã‚ã‚“ãŸã¯é ‘å¼µã‚Œ", "å¿ƒã€è½ã¡ç€ã‹ã›ã¨ã‘ã€‚ã†ã‚‹ã•ã„ã®è‹¦æ‰‹ã ã‹ã‚‰"],
        "trend": "åˆ¤æ–­åŠ›ãŒå¢—ã—ã¦é›†ä¸­ã—ã‚„ã™ã„ã€‚",
        "advice": "é™ã‹ãªå ´æ‰€ã§è€ƒãˆäº‹ã™ã‚‹ã¨ã„ã„ã‹ã‚‚ãªã€‚äººã®è©±ã¯ã‚ˆãèã‘ã‚ˆã€‚"
    },
    {
        "color": "é»„",
        "emotion": ["å…ƒæ°—ã«è¦‹ã›ã¨ã‘ã°ä½•ã¨ã‹ãªã‚‹â€¦ã‹ã‚‚ãª", "æ˜ã‚‹ãæŒ¯ã‚‹èˆã†ã®ã£ã¦ã€ã‘ã£ã“ã†ç–²ã‚Œã‚‹ã‚“ã ãï¼Ÿ"],
        "trend": "å¥½å¥‡å¿ƒã¨ç¤¾äº¤æ€§ãŒé«˜ã¾ã‚‹æ—¥ã€‚",
        "advice": "äººã¨è©±ã™ã®ã‚‚æ‚ªããªã„ã€‚ãŸã ã—ç„¡ç†ã™ã‚“ãªã‚ˆã€‚"
    },
    {
        "color": "ç·‘",
        "emotion": ["ç©ã‚„ã‹ï¼Ÿâ€¦ã‚‰ã—ãã­ã‡ã‘ã©ä»Šæ—¥ã¯ãã‚Œã§ã„ã„", "ã®ã‚“ã³ã‚Šã—ã™ãã¦è…ã‚‹ãªã‚ˆ"],
        "trend": "ãƒãƒ©ãƒ³ã‚¹æ„Ÿè¦šã¨ç™’ã—ãŒãƒ†ãƒ¼ãƒã€‚",
        "advice": "è‡ªç„¶ã«è§¦ã‚Œã¦ã¿ã‚ã€‚æ·±å‘¼å¸ãã‚‰ã„ã¯ã—ã¨ã‘ã€‚"
    },
    {
        "color": "ç´«",
        "emotion": ["ã¡ã‚‡ã£ã¨ã‚«ãƒƒã‚³ã¤ã‘ãŸã„æ°—åˆ†ã‹ï¼Ÿä¼¼åˆã†ã¨ã„ã„ã‘ã©ãª", "ä»Šæ—¥ã¯ç¥ç§˜çš„ãªãƒ•ãƒªã—ã¨ãï¼Ÿ"],
        "trend": "æ„Ÿå—æ€§ãŒé«˜ã¾ã‚Šã€ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ¹§ãæ—¥ã€‚",
        "advice": "ã‚¢ãƒ¼ãƒˆã¨ã‹éŸ³æ¥½ã«è§¦ã‚Œã¦ã¿ã€‚æ„å¤–ã¨ãƒãƒã‚‹ã‹ã‚‚ãªã€‚"
    },
    {
        "color": "é»’",
        "emotion": ["ã‚„ã£ã±é»’ã ã‚ˆãªã€‚ç„¡é›£ã§è½ã¡ç€ã", "ä»Šæ—¥ã¯ç›®ç«‹ãŸãšé™ã‹ã«ã—ã¦ã‚ã£ã¦ã“ã¨ã "],
        "trend": "è‡ªå·±é˜²è¡›åŠ›ãƒ»é›†ä¸­åŠ›ãŒå¼·ã¾ã‚‹ã€‚",
        "advice": "ä½™è¨ˆãªã“ã¨è¨€ã‚ãšã«é»™ã£ã¦è¡Œå‹•ã—ã‚ã€‚ãã‚ŒãŒå‰ã€‚"
    },
    {
        "color": "ç™½",
        "emotion": ["ç™½â€¦ã ã¨ï¼Ÿâ€¦ç´”ç²‹ã¶ã£ã¦ã‚“ã˜ã‚ƒã­ã‡ã‚ˆ", "ã¾ãâ€¦ãƒªã‚»ãƒƒãƒˆã£ã¦æ„å‘³ã§ã¯æ‚ªãã­ã‡ã‹"],
        "trend": "åˆå¿ƒã«å¸°ã‚Œã‚‹æ—¥ã€‚æ–°ã—ã„ã“ã¨ã«å‘ã„ã¦ã‚‹ã€‚",
        "advice": "éƒ¨å±‹ã‚’ç‰‡ä»˜ã‘ã‚ã€‚é ­ã®ä¸­ã‚‚ã‚¹ãƒƒã‚­ãƒªã™ã‚“ãã€‚"
    },
    {
        "color": "ãƒ”ãƒ³ã‚¯",
        "emotion": ["ã†ã‚â€¦ãƒ”ãƒ³ã‚¯ã£ã¦â€¦ã‚ã‚“ãŸæœ¬æ°—ï¼Ÿ", "ã¾ã€å„ªã—ãã§ãã‚‹ãªã‚‰ã‚„ã£ã¦ã¿ã‚ã‚ˆ"],
        "trend": "æ‹æ„›é‹ã‚„å¯¾äººé‹ãŒã¡ã‚‡ã„é«˜ã‚ã®æ—¥ã€‚",
        "advice": "ç”˜ãˆãŸã„ãªã‚‰ç´ ç›´ã«è¨€ãˆã€‚ãŸã¾ã«ã¯ãªã€‚"
    }
]

def run_lucky_color(user_id):
    lucky = random.choice(lucky_colors)
    return (
        f"ğŸŒˆ ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼ã¯ã€{lucky['color']}ã€"
        f"ã‚¯ãƒ­ãƒï¼š{random.choice(lucky['emotion'])}"
        f"ğŸ– è‰²ã®å‚¾å‘ï¼š{lucky['trend']}"
        f"ğŸ«– ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼š{lucky['advice']}"
    )

# ==========================
# â‘¢ æ„Ÿæƒ…ãƒ»ã‚»ãƒªãƒ•æ¼”å‡ºï¼ˆæ¯’èˆŒãƒ»ã‚„ã•ã—ã•ãƒ»ã‚ãã‚Œãƒ»çš®è‚‰ãªã©ï¼‰
# ==========================

emotion_patterns = {
    "neutral": ["ãµãƒ¼ã‚“", "ã¾ããª", "ã©ã†ã§ã‚‚ã„ã„ã‘ã©ãª"],
    "sarcastic": ["ç¬‘ã‚ã›ã‚“ãªã‚ˆ", "ãã‚Œæœ¬æ°—ã§è¨€ã£ã¦ã‚“ã®ã‹ï¼Ÿ", "ã‚„ã‚Œã‚„ã‚Œ"],
    "encouraging": ["â€¦â€¦é ‘å¼µã‚Œã‚ˆã€ã¡ã‚‡ã£ã¨ã ã‘ãª", "ã‚ªãƒ¬ã§ã‚‚å¿œæ´ã™ã‚‹æ™‚ã‚ã‚‹ã"],
}


# ==========================
# â‘£ å®šæ•°ãƒ»è¨­å®šã‚¨ãƒªã‚¢ï¼ˆã‚«ãƒ¼ãƒ‰ãƒ»è‰²ãƒ»æ¼”å‡ºã®ç´ æç¾¤ï¼‰
# ==========================

tarot_cards = [
    {"name": "æ„šè€…", "meaning": "è‡ªç”±ã€å†’é™º", "score": 3},
    # ... ä»–ã‚«ãƒ¼ãƒ‰è¿½åŠ 
]

lucky_colors = [
    {"color": "èµ¤", "comment": ["ä»Šæ—¥ã®èµ¤ã¯ã¡ã‚‡ã£ã¨ã‚¢ãƒ„ã„ã‹ã‚‚ãª"]},
    # ... ä»–ã®è‰²
]


# ==========================
# â‘¤ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ï¼ˆå…±é€šå‡¦ç†ãƒ»æ—¥ä»˜å¤‰æ›ãƒ»æ•´å½¢ãªã©ï¼‰
# ==========================

def format_tarot_result(card):
    return f"ã€{card['name']}ã€‘æ„å‘³ï¼š{card['meaning']}"

def log_state(user_id, state):
    print(f"[LOG] {user_id} â†’ çŠ¶æ…‹ï¼š{state}")

def get_today_str():
    from datetime import datetime
    return datetime.now().strftime("%Y-%m-%d")


# ==========================
# â‘¥ ãƒ­ã‚°ãƒ»ãƒ‡ãƒãƒƒã‚°è¡¨ç¤ºï¼ˆã‚¹ãƒ†ãƒ¼ãƒˆç¢ºèªãªã©ï¼‰
# ==========================

# é–‹ç™ºä¸­ã¯ã“ã“ã«ãƒ­ã‚°å‡ºåŠ›ã€Renderã®Logsã§ç¢ºèªã—ã‚„ã™ã
# æœ¬ç•ªæ™‚ã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆOK

# log_state(user_id, user_states[user_id])


# ==========================
# â‘¦ å¤–éƒ¨é€£æºç”¨ã‚¹ãƒšãƒ¼ã‚¹ï¼ˆDBæ¥ç¶šãƒ»å±¥æ­´ä¿å­˜ãªã©ï¼‰
# ==========================

# ä¾‹ï¼šFirebaseã‚„ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ãªã©å°å…¥ã™ã‚‹å ´åˆã¯ã“ã“ã«è¿½è¨˜

# def save_result_to_db(user_id, result):
#     pass  # TODO: å®Ÿè£…äºˆå®š

if __name__ == "__main__":
    port = int(os.environ.get("PORT", 10000))
    app.run(host="0.0.0.0", port=port)